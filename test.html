<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>釜山 2026 孝親團</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F8FAFC; }
        .bg-teal-custom { background-color: #43968F; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="max-w-md mx-auto min-h-screen pb-24 shadow-xl overflow-x-hidden">

<div id="app">
    <div class="bg-teal-custom text-white pt-8 pb-6 px-5 rounded-b-[40px] shadow-lg">
        <div class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-2">
                <i class="fas fa-bars opacity-70"></i>
                <h1 class="text-2xl font-bold">釜山 <i class="fas fa-plane text-sm opacity-50"></i></h1>
            </div>
            <div class="flex gap-2">
                <div class="bg-white/20 p-2 rounded-lg text-sm"><i class="fas fa-language"></i></div>
                <div class="bg-white p-2 rounded-lg text-teal-600 shadow-sm"><i class="fas fa-calendar-alt"></i></div>
                <div class="bg-white/20 p-2 rounded-lg text-sm"><i class="fas fa-map"></i></div>
                <div class="bg-white/20 p-2 rounded-lg text-sm"><i class="fas fa-dollar-sign"></i></div>
            </div>
        </div>

        <div class="flex gap-3 overflow-x-auto hide-scrollbar pb-2">
            <div v-for="(day, index) in days" :key="index" @click="currentDayIndex = index"
                 :class="['flex-shrink-0 w-16 h-20 rounded-2xl flex flex-col items-center justify-center transition-all', 
                          currentDayIndex === index ? 'bg-white text-teal-600 scale-105 shadow-md' : 'bg-white/20 text-white opacity-70']">
                <span class="text-[10px]">{{ day.dateLabel }}</span>
                <span class="text-xl font-bold">D{{ index + 1 }}</span>
                <span class="text-[10px]">{{ day.weekDay }}</span>
            </div>
        </div>
    </div>

    <main class="px-5 -mt-4">
        <div class="bg-white rounded-3xl p-5 shadow-md border border-gray-50 mb-4 flex justify-between items-center">
            <div>
                <h2 class="text-xl font-bold text-gray-800">{{ days[currentDayIndex].dateLabel }} ({{ days[currentDayIndex].weekDay }})</h2>
                <p class="text-gray-400 text-xs">抵達 & 探索</p>
            </div>
            <div class="text-right">
                <div class="flex items-center gap-1 text-indigo-600 font-bold">
                    <i class="fas fa-sun"></i>
                    <span>0° - 10°</span>
                </div>
                <p class="text-[9px] text-gray-300 italic">釜山 (預報)</p>
            </div>
        </div>

        <div class="bg-white rounded-3xl overflow-hidden shadow-sm mb-4">
            <div class="h-48 bg-gray-100">
                <iframe v-if="mapUrl" width="100%" height="100%" frameborder="0" style="border:0" :src="mapUrl"></iframe>
            </div>
            <div class="p-3 flex justify-between items-center px-4">
                <span class="text-xs text-green-500 flex items-center gap-1">
                    <span class="w-2 h-2 bg-green-500 rounded-full"></span> 地圖自動定位今日行程
                </span>
                <button @click="openGoogleMaps" class="bg-teal-50 text-teal-600 text-xs px-3 py-1 rounded-lg font-bold">導航</button>
            </div>
        </div>

        <div class="border-2 border-dashed border-gray-200 rounded-3xl p-4 text-center text-gray-400 text-sm mb-6">
            <i class="fas fa-plane-arrival mr-2"></i> 新增當日航班資訊
        </div>

        <div class="flex justify-between items-center mb-4">
            <button @click="showModal = true" class="text-teal-500 font-bold text-sm">+ 新增行程</button>
        </div>

        <div class="space-y-4">
            <div v-for="(item, idx) in currentDayItems" :key="idx" class="bg-white p-4 rounded-2xl shadow-sm border border-gray-50 flex gap-4">
                <div class="text-teal-600 font-bold text-sm min-w-[45px]">{{ item.time }}</div>
                <div class="flex-1 text-sm font-bold text-gray-700">{{ item.location }}</div>
                <button @click="deleteItem(idx)" class="text-red-200"><i class="fas fa-times"></i></button>
            </div>
        </div>

        <button v-if="days.length > 1" @click="removeDay" class="w-full text-center text-red-300 text-xs py-10">
            <i class="fas fa-trash-alt mr-1"></i> 刪除這一天
        </button>
    </main>

    <div class="fixed bottom-24 right-5">
        <button @click="exportCode" class="bg-orange-500 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center">
            <i class="fas fa-sync-alt"></i>
        </button>
    </div>

    <div v-if="showModal" class="fixed inset-0 bg-black/60 z-50 flex items-end">
        <div class="bg-white w-full rounded-t-[30px] p-8">
            <h3 class="font-bold mb-4 text-gray-700">新增行程</h3>
            <input v-model="newItem.time" type="time" class="w-full p-3 bg-gray-100 rounded-xl mb-3 border-none">
            <input v-model="newItem.location" type="text" placeholder="地點名稱" class="w-full p-3 bg-gray-100 rounded-xl mb-6 border-none">
            <div class="flex gap-3">
                <button @click="saveItem" class="flex-1 bg-teal-custom text-white py-3 rounded-xl font-bold">儲存</button>
                <button @click="showModal = false" class="flex-1 bg-gray-100 text-gray-400 py-3 rounded-xl">取消</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, watch, onMounted } = Vue;
createApp({
    setup() {
        const currentDayIndex = ref(0);
        const showModal = ref(false);
        const newItem = ref({ time: '09:00', location: '' });
        const days = ref([
            { dateLabel: '2/23', weekDay: '(一)', items: [{time: '17:00', location: '釜山金海機場'}, {time: '19:30', location: '南浦洞蔘雞湯'}] },
            { dateLabel: '2/24', weekDay: '(二)', items: [{time: '10:30', location: '海雲台天空膠囊列車'}] },
            { dateLabel: '2/25', weekDay: '(三)', items: [{time: '10:00', location: '甘川洞文化村'}] },
            { dateLabel: '2/26', weekDay: '(四)', items: [{time: '11:00', location: '螞蟻家章魚火鍋'}] }
        ]);

        const currentDayItems = computed(() => days.value[currentDayIndex.value].items);
        const mapUrl = computed(() => {
            const locs = currentDayItems.value.map(i => i.location);
            if (locs.length === 0) return null;
            return `https://maps.google.com/maps?q=${encodeURIComponent(locs.join(' '))}&t=&z=13&ie=UTF8&iwloc=&output=embed`;
        });

        const openGoogleMaps = () => {
            const locs = currentDayItems.value.map(i => encodeURIComponent(i.location));
            window.open("https://www.google.com/maps/dir/Current+Location/" + locs.join('/'), '_blank');
        };

        const saveItem = () => {
            if (newItem.value.location) {
                days.value[currentDayIndex.value].items.push({ ...newItem.value });
                days.value[currentDayIndex.value].items.sort((a,b)=>a.time.localeCompare(b.time));
                showModal.value = false;
                newItem.value = { time: '09:00', location: '' };
            }
        };

        const deleteItem = (idx) => { days.value[currentDayIndex.value].items.splice(idx, 1); };
        const removeDay = () => { if(confirm('確定刪除？')) days.value.splice(currentDayIndex.value, 1); };

        // 匯出代碼功能：解決同步到 GitHub 的煩惱
        const exportCode = () => {
            const currentHTML = document.documentElement.outerHTML;
            const dataString = JSON.stringify(days.value);
            // 提醒使用者如何同步
            alert("請在電腦上編輯 GitHub 上的 test.html，將新的行程數據貼上 defaultDays 區塊即可完成永久更新！");
            console.log("當前數據：", dataString);
        };

        watch(days, (newVal) => { localStorage.setItem('busan_v_final', JSON.stringify(newVal)); }, { deep: true });
        onMounted(() => {
            const saved = localStorage.getItem('busan_v_final');
            if (saved) days.value = JSON.parse(saved);
        });

        return { days, currentDayIndex, currentDayItems, showModal, newItem, mapUrl, saveItem, deleteItem, removeDay, openGoogleMaps, exportCode };
    }
}).mount('#app')
</script>
</body>
</html>
